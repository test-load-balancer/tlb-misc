\documentclass{beamer}
\mode<presentation>
{
  \usetheme{Warsaw}
  \setbeamercovered{transparent}
}


\usepackage[english]{babel}
\usepackage[latin1]{inputenc}
\usepackage{times}
\usepackage[T1]{fontenc}

\title[TLB - https://github.com/test-load-balancer]
      {TLB}

\subtitle
    {a test load balancer for you}

\author[Pavan, Janmejay]
       {Pavan KS\inst{1} \and Janmejay Singh\inst{2}}

\institute[ThoughtWorks Studios]
{
  \inst{1}%
  mail: itspanzi@gmail.com\\
  blog: http://itspanzi.blogspot.com
  \and
  \inst{2}%
  mail: singh.janmejay@gmail.com\\
  blog: http://codehunk.wordpress.com
}

\date[xconf] 
{XConf Pune, 2010}

\subject{Introduction to internals of TLB, and its usage}
% \pgfdeclareimage[height=0.5cm]{logo}{logo-filename}
% \logo{\pgfuseimage{logo}}

\AtBeginSubsection[]
{
  \begin{frame}<beamer>{Outline}
    \tableofcontents[currentsection,currentsubsection]
  \end{frame}
}

% If you wish to uncover everything in a step-wise fashion, uncomment the following command: 
%\beamerdefaultoverlayspecification{<+->}

\begin{document}

\begin{frame}
  \titlepage
\end{frame}

\begin{frame}{Outline}
  \tableofcontents
  % You might wish to add the option [pausesections]
\end{frame}

\section{Motivation}

\subsection{Problem that we solved}

\begin{frame}{This is the story of how we went from...}
  \begin{centering}
    \pgfimage[width=10cm]{images/no-balance-go.png}
    \par
  \end{centering}
\end{frame}

\begin{frame}{to...}
  \begin{centering}
    \pgfimage[width=10cm]{images/count-balance-go.png}
    \par
  \end{centering}
\end{frame}

\begin{frame}{to...}
  \begin{centering}
    \pgfimage[width=10cm]{images/time-balance-go.png}
    \par
  \end{centering}
\end{frame}

\begin{frame}{by changing}
  \begin{centering}
    ...just a few lines in the build script
  \end{centering}
\end{frame}

\subsection{Dream: Fast Builds}

\begin{frame}
  \begin{centering}
    \begin{itemize}
    \item Fast build = Rapid development
      \pause
    \item Devs spend less time waiting to checkin
      \begin{itemize}
      \item Need not be limited to unit/integration tests          
      \item Functional/Acceptance tests
      \end{itemize}
      \pause
    \item Easier for devs to run precommit builds - Results in pulling upstream changes often and running builds frequently
    \end{itemize}
  \end{centering}
\end{frame}

\begin{frame}{but...}
  \begin{centering}
    \begin{itemize}
    \item Major part of build time is spent in running tests
      \pause
    \item Speeding up builds is non trivial
      \pause
    \item Most TW teams have a dev task for this don\text{'}t they??
    \end{itemize}
  \end{centering}
\end{frame}

\begin{frame}{Usual ways}
  \begin{centering}
    \begin{itemize}
    \item Split applications into modules
      \pause
      \begin{itemize}
      \item Difficult to model (typically end up in diamond dependencies)
        \pause
      \item If downstream dependencies fail, turn around time to fix is huge
      \end{itemize}      
      \pause
    \item Throw more hardware at it - Slice and dice
      \pause
      \begin{itemize}
      \item Hand written partitioning using directories/tags etc (unequal partitions)
        \pause
      \item Pipelines (unit -> integration -> smoke -> functional) (serial process)
      \end{itemize}
    \end{itemize}
    \pause
    Logical! but Suboptimal :-(
  \end{centering}
\end{frame}

\section{TLB}

\subsection{Introducing TLB}

\begin{frame}{What if partitioning can be off-loaded?}
  What does TLB do?
  \begin{itemize}
  \item Makes \texttt{n} partitions
    \pause
  \item Understands which partition the \emph{current test runner process} is
    \pause
  \item Runs only \texttt{one} of the \texttt{n} \emph{mutually exclusive \& collectively exhaustive} sets
  \end{itemize}
\end{frame}


\begin{frame}{Count-based Balancing}
  \begin{centering}
    20 tests / 4 splits $\approx$ 5 on each
  \end{centering}
\end{frame}

\begin{frame}{Time-based Balancing}{inspired by Amdahl`s law}
  N tests / 4 splits $\approx$ 4 splits that take equal time
\end{frame}

\begin{frame}{Smoothened Time-based Balancing}{ensures no outliers}
  N tests / 4 splits $\approx$ 4 splits which take equal time based on history over past runs (Exponential smoothing ensures no outliers)\\
  While exponential smoothing, every test-time entry $ S_t \quad \forall t > 0 $ is recorded as:\\
  \begin{alignat}{3}
    S_1 & = x_o\\
    S_t & = \alpha x_{t-1} + (1 - \alpha)S_{t-1} \quad
    \forall 
    \begin{cases}
      t > 1\\ 
      0 < \alpha < 1
    \end{cases}
  \end{alignat}

  Where $\alpha$ is the factor of smoothing, which can be tuned externally and \texttt{x} is unsmoothed reading.
\end{frame}

\begin{frame}{Failed First Orderer}{Runs tests that failed last time around, first}
  Perfect for fixing builds that have a tendency to break after 6 in the evening.\\
  \quad\\
  You don\text{'}t need to wait for the entire build, just watch the console log for a few minutes, as you see the test you fixed pass and scroll by.
\end{frame}

\subsection{Hooking it up with your testing tool/CI server}

\begin{frame}{Supported Frameworks}
  \begin{centering}
    \begin{itemize}
      \item {\color{green}Junit}, {\color{green}Twist} using {\color{red}Ant} or {\color{red}Buildr} for {\color{blue}Java}
        \pause
      \item {\color{green}Rspec} using {\color{red}Rake} (for both {\color{blue}MRI} and {\color{blue}JRuby})
    \end{itemize}
  \end{centering}
\end{frame}

\begin{frame}{We plan to support...}
  \begin{centering}
    \begin{itemize}
    \item {\color{green}TestUnit} {\color{blue}MRI \& JRuby}
    \item {\color{red}Nant} {\color{blue}.Net}
    \item {\color{green}MSTest} {\color{blue}.Net}
    \item {\color{green}TestNG} {\color{blue}Java}
    \item {\color{red}Maven} {\color{blue}Java}
    \item {\color{green}PyUnit} {\color{blue}Python}
    \item {\color{green}Cucumber} {\color{blue}MRI \& JRuby}
    \item {\color{green}CPPUnit} {\color{blue} C++}
    \item {\color{green} 5am (fiveam)} {\color{blue} CommonLisp}
    \end{itemize}
  \end{centering}
  \pause
  \begin{centering}
    \begin{itemize}
      \item Bad news is, we haven't started work on most of these yet.
        \pause
      \item Good news is, we have good hackers, like yourself, listening to us here, who can help!
    \end{itemize}
  \end{centering}
\end{frame}

\begin{frame}{And we plan to support...}
  \begin{center}
    Anything else that you would like to contribute :-)
  \end{center}
\end{frame}

\begin{frame}{Leverage parallel execution capabilities of}{tools like...}
  \begin{center}
    \pgfimage[height=1.5cm]{images/go-logo.png}
  \end{center}
\end{frame}

\begin{frame}{or for that matter}
  \begin{center}
    {\huge Hudson, Bamboo, TeamCity, Ant Hill Pro}(if you are rich enough),{\huge or even Shell script fork}(if you are a poor dev like us).\\
    \quad\\\quad\\
    {\footnotesize PS: You did not see this slide :-)}
  \end{center}
\end{frame}

\subsection{Under the hood}

\begin{frame}{Typical TLB setup}
  \begin{centering}
  \pgfimage[width=9.5cm]{images/typical-setup.png}
  \end{centering}
\end{frame}

\section*{Summary}

\begin{frame}{Summary}{}
  \begin{centering}
  {\huge We are patch hungry*.\\Please Contribute.\\}
  (its BSD 2 clause)\\
  \quad\\
  {\huge Thank you.}\\
  \quad\\
  \quad\\
  References:\\
  http://github.com/test-load-balancer/tlb\\
  http://github.com/test-load-balancer/tlb\_rb\\
  \quad\\
  * http://github.com/test-load-balancer/tlb/issues\\
  \end{centering}
\end{frame}



% All of the following is optional and typically not needed. 
%% \appendix
%% \section<presentation>*{\appendixname}
%% \subsection<presentation>*{For Further Reading}

%% \begin{frame}[allowframebreaks]
%%   \frametitle<presentation>{For Further Reading}
    
%%   \begin{thebibliography}{10}
    
%%   \beamertemplatebookbibitems
%%   % Start with overview books.

%%   \bibitem{Author1990}
%%     A.~Author.
%%     \newblock {\em Handbook of Everything}.
%%     \newblock Some Press, 1990.
 
    
%%   \beamertemplatearticlebibitems
%%   % Followed by interesting articles. Keep the list short. 

%%   \bibitem{Someone2000}
%%     S.~Someone.
%%     \newblock On this and that.
%%     \newblock {\em Journal of This and That}, 2(1):50--100,
%%     2000.
%%   \end{thebibliography}
%% \end{frame}

\end{document}


